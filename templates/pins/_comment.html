<!-- Single Comment -->
<div class="comment" id="comment-{{ comment.id }}" data-comment-id="{{ comment.id }}">
    <div class="flex gap-4">
        <!-- Avatar -->
        {% if comment.user.profile_picture %}
            <img src="{{ comment.user.profile_picture.url }}" class="w-10 h-10 rounded-full object-cover flex-shrink-0" alt="{{ comment.user.username }}">
        {% else %}
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-[#db2777] to-[#be185d] flex items-center justify-center text-white font-bold flex-shrink-0">
                {{ comment.user.username.0|upper }}
            </div>
        {% endif %}
        
        <!-- Comment Content -->
        <div class="flex-1">
            <div class="bg-gray-50 rounded-2xl px-4 py-3">
                <div class="flex items-center gap-2 mb-1">
                    <a href="{% url 'users:profile' comment.user.username %}" class="font-bold text-gray-900 hover:underline">
                        {{ comment.user.username }}
                    </a>
                    {% if comment.user == pin.user %}
                        <span class="px-2 py-0.5 bg-[#db2777] text-white text-xs rounded-full font-semibold">Author</span>
                    {% endif %}
                    <span class="text-xs text-gray-500">â€¢ {{ comment.created_at|timesince }} ago</span>
                </div>
                <p class="text-gray-800 whitespace-pre-wrap break-words">{{ comment.text }}</p>
            </div>
            
            <!-- Comment Actions -->
            <div class="flex items-center gap-4 mt-2 px-2">
                {% if user.is_authenticated %}
                <!-- Like Button -->
                <button 
                    onclick="likeComment({{ comment.id }})" 
                    class="like-comment-btn flex items-center gap-1 text-sm font-semibold transition hover:text-[#db2777] {% if user in comment.likes.all %}text-[#db2777]{% else %}text-gray-600{% endif %}"
                    data-comment-id="{{ comment.id }}"
                >
                    <svg class="w-4 h-4" fill="{% if user in comment.likes.all %}currentColor{% else %}none{% endif %}" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>
                    <span class="like-count">{{ comment.like_count }}</span>
                </button>
                
                <!-- Reply Button -->
                <button 
                    onclick="showReplyForm({{ comment.id }})" 
                    class="text-sm font-semibold text-gray-600 hover:text-[#db2777] transition"
                >
                    Reply
                </button>
                
                <!-- Delete Button (only for comment owner) -->
                {% if comment.user == user %}
                <button 
                    onclick="deleteComment({{ comment.id }})" 
                    class="text-sm font-semibold text-gray-600 hover:text-red-600 transition"
                >
                    Delete
                </button>
                {% endif %}
                {% endif %}
                
                <!-- Show Replies Link -->
                {% if comment.reply_count > 0 %}
                <button 
                    onclick="toggleReplies({{ comment.id }})" 
                    class="text-sm font-semibold text-[#db2777] hover:underline"
                    id="toggle-replies-{{ comment.id }}"
                >
                    View {{ comment.reply_count }} {{ comment.reply_count|pluralize:"reply,replies" }}
                </button>
                {% endif %}
            </div>
            
            <!-- Reply Form (hidden by default) -->
            {% if user.is_authenticated %}
            <div id="reply-form-{{ comment.id }}" class="hidden mt-4">
                <div class="flex gap-3">
                    {% if user.profile_picture %}
                        <img src="{{ user.profile_picture.url }}" class="w-8 h-8 rounded-full object-cover flex-shrink-0" alt="{{ user.username }}">
                    {% else %}
                        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-[#db2777] to-[#be185d] flex items-center justify-center text-white font-bold text-sm flex-shrink-0">
                            {{ user.username.0|upper }}
                        </div>
                    {% endif %}
                    <div class="flex-1">
                        <textarea 
                            id="reply-text-{{ comment.id }}" 
                            rows="2" 
                            placeholder="Write a reply..."
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-xl focus:border-[#db2777] focus:ring-2 focus:ring-[#db2777]/20 outline-none resize-none text-sm"
                            maxlength="1000"
                        ></textarea>
                        <div class="flex gap-2 mt-2">
                            <button 
                                onclick="submitReply({{ comment.id }})" 
                                class="px-4 py-2 bg-gradient-to-r from-[#db2777] to-[#be185d] text-white rounded-full text-sm font-bold hover:shadow-lg transition"
                            >
                                Reply
                            </button>
                            <button 
                                onclick="hideReplyForm({{ comment.id }})" 
                                class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full text-sm font-bold transition"
                            >
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Replies Container -->
            <div id="replies-{{ comment.id }}" class="hidden mt-4 space-y-4 pl-6 border-l-2 border-gray-200">
                {% for reply in comment.replies.all %}
                    {% include 'pins/_comment.html' with comment=reply %}
                {% endfor %}
            </div>
        </div>
    </div>
</div>
